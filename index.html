<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Gerador de VÃ­deos Heygen</title>
</head>
<body>
  <h1>Crie seu vÃ­deo com avatar</h1>
  <label for="avatar">Escolha um avatar:</label>
  <select id="avatar"></select><br><br>

  <label for="voice">Escolha uma voz:</label>
  <select id="voice"></select><br><br>

  <label for="texto">Digite o texto:</label><br>
  <textarea id="texto" rows="4" cols="50" placeholder="Digite aqui..."></textarea><br><br>

  <button onclick="gerar()">ðŸŽ¬ Gerar VÃ­deo</button>
  <p id="status"></p>
  <a id="link" target="_blank" style="display:none">ðŸ“¥ Baixar VÃ­deo</a>

  <script>
    fetch('/avatars').then(r => r.json()).then(data => {
      data.data.avatars.forEach(a => {
        let o = document.createElement('option');
        o.value = a.avatar_id;
        o.text = a.avatar_name;
        document.getElementById('avatar').appendChild(o);
      });
    });

    fetch('/voices').then(r => r.json()).then(data => {
      data.data.voices.forEach(v => {
        let o = document.createElement('option');
        o.value = v.voice_id;
        o.text = v.name + " (" + v.language + ")";
        document.getElementById('voice').appendChild(o);
      });
    });

    function gerar() {
      const avatar = document.getElementById('avatar').value;
      const voice = document.getElementById('voice').value;
      const texto = document.getElementById('texto').value;

      document.getElementById('status').innerText = "Gerando vÃ­deo...";
      document.getElementById('link').style.display = 'none';

      fetch('/gerar-video', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({avatar_id: avatar, voice_id: voice, texto})
      }).then(r => r.json()).then(res => {
        if (res.video_url) {
          document.getElementById('status').innerText = "VÃ­deo pronto!";
          document.getElementById('link').href = res.video_url;
          document.getElementById('link').innerText = "ðŸŽ¥ Assistir/Download";
          document.getElementById('link').style.display = 'block';
        } else {
          document.getElementById('status').innerText = "Erro: " + JSON.stringify(res);
        }
      });
    }
  </script>
</body>
</html>
